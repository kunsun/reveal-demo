<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>使用Webpack构建前端项目</title>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-markdown>
          <img src="./src/image/webpack-icon.svg" alt="webpack-icon" width="200px" style="background: none; border: none; box-shadow: none;">
          ### 使用*Webpack*构建前端项目
          <br>
          <small>
            小米移动前端-杨坤
          </small>
        </section>

        <section data-markdown>
          <img src="./src/image/webpack.svg" alt="webpack">
        </section>

        <section data-markdown>
          ### *万物皆模块*
          <small>
            构造模块化的开发体系
          </small>
          ```dart
            import img from "file.png";
            import css from "file.css";
            import sass from "file.sass";
          ```
        </section>

        <section data-markdown>
          * 环境搭建
          * *开发*
          * *部署*
        </section>
          
        <section data-markdown>
          ### *1. 环境搭建*
          * 本地mock数据
          * hot reload
          * 本地静态文件服务器
        </section>
        <section data-markdown>
          #### 本地mock数据
          <small>
            *依据后端的wiki*
          </small>
          ```dart
            const router = require('express').Router();

            router.get('/wheel/turntableInfo', (req, res) => {
              res.json({
                rtnCode: 0,
                rtnMsg: 'ok',
                data: {
                  remainingTimes: 7,
                },
              });
            });
          ```
        </section>
        <section data-markdown>
          #### 热加载
          <small>
            *简单版*
          </small>
          ```shell
            webpack-dev-server --hot
          ```
          ```javascript
            //css
            {
              loader: 'style-loader',
              options: {
                hmr: true,
              }
            }
          ```
        </section>
        <section data-markdown>
          #### 热加载
            <small>
              *升级版*
            </small>

            ```javascrpt
              var webpackConfig = require('./webpack.config');
              var compiler = webpack(webpackConfig);
              app.use(require("webpack-dev-middleware")(compiler, {
                  noInfo: true, publicPath: webpackConfig.output.publicPath
              }));
              app.use(require("webpack-hot-middleware")(compiler, options));
            ```

            ```javascript
              entry: {
                app: ['webpack-hot-middleware/client?reload=true', 'main.js']
              }
              plugins: {
                new webpack.HotModuleReplacementPlugin(),
              }
            ```
        </section>
        <section data-markdown>
          #### 本地静态文件服务器

          ```shell
            localhost:8080\page1
            localhost:8080\page2
            localhost:8080\page3
          ```
          ```javascript
            page1.html  page2.html  page3.html
          ```
        </section>
        <section data-markdown>
          <img src="./src/image/html-template.png" alt="" width="600px">
          <img src="./src/image/html-file.png" alt="" width="600px">
        </section>
        <section data-markdown>
          ```javascript
            plugins: [
              new HtmlWebpackPlugin({
                template: './src/page1.html',
              }),
            ],
          ```

          ```javascript
            app.get('/act/:name', (req, res) => {
              const path = webpackConfig.output.path + '/' + req.params.name + '.html';
              const htmlBuffer = devMiddlewareInstance.fileSystem.readFileSync(path);
              res.cookie('userId', 123456);
              res.send(htmlBuffer.toString());
            });
          ```
        </section>
        <style>
        .bloom{
        transform: scale(0);
        transition: transform 0.7s cubic-bezier(0.68, 0.04, 0.49, 0.95);
        }
        .present .bloom{
        transform: scale(1);
        }
        </style>
        <section data-markdown>
          <div class="bloom">
            <h3><em>2. 开发</em></h3>
          </div>
        </section>
        <section data-markdown data-background='./src/image/confused.jpg' style="background: rgba(0,0,0,0.7)">
          ### 前端开发的特点：
          1. 大体量： 多功能、多页面、多状态、多系统
          2. 大规模： 多人合作开发
          3. 高性能： CDN部署、缓存机制、按需加载、请求合并、文件打包
        </section>
        <section data-markdown>
          * *组件化开发*
          ```javascript
            按照功能划分，分为三个层次的组件：
            页面级(page)、组件级(component)、JS模块(utils)
          ```
          * *做好资源管理*
          ```javascript
            开发过程中的资源管理：
              1. js、css、jsx、vue的编译
              2. js、css、图片、字体等路径的处理
              3. 框架和库的使用
            性能优化：
              减少文件体积、减少http请求次数、代码分块、按需加载、cdn资源处理、css提取、打包文件名更新
          ```
        </section>
        <section data-markdown>
          <h4>之前的页面结构</h4>
          <img src="./src/image/css-files.png" alt="" height="400px">
          <img src="./src/image/js-files.png" alt="" height="400px">
        </section>
        <section data-markdown>
          <h4>模块化后的页面结构</h4>
          <div>
            <img src="./src/image/components-02.png" alt="">
          </div>
        </section>
        <section data-markdown>
          <h4>组件示意图</h3>
          <img src="./src/image/components-03.png" alt="">
        </section>
        <section data-markdown>
          <h4>编写一个dialog</h4>
          ```javascript
            import { getInfo } from '../utils/api';
            import getCookie from '../utils/cookie';
            import './dialog.css';
            import icon from './success-icon.png';
          ```
          用到的webpack loader:
          ```javascript
            1. file-loader
            2. url-loader
            3. babel-loader
            4. css-loader
            5. style-loader
          ```
        </section>
        <section data-markdown>
          路径处理
          ```javascript
            import img from 'icon.png';
            
            var myImage = new Image(100, 200);
            myImage.src = img;
            document.body.appendChild(myImage);
          ```
          ```javascript
            {
              test: /\.(png|jpg|jpeg|gif|eot|ttf|woff|woff2|svg|svgz)(\?.+)?$/,
              use: [{
                loader: 'url-loader',
                options: {
                  limit: 8192, //Byte limit to inline files as Data URL
                }
              }]
            },
          ```
        </section>
        <section data-markdown>
          <small>
            小图片
          </small>
          ```javascript
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSAAABVC...">
          ```
          <small>
            大图片
          </small>
          ```javascript
            <img src="/img/icon.png">
          ```
        </section>
        <section data-markdown>
          <h4>框架的引入</h4>

          <small>
            React: *.jsx*解析
          </small>
          ```javascript
            babel-loader  babel-preset-react
          ```
          <small>
            Vue: *.vue*模板文件
          </small>
          ```javascript
            {
              test: /\.vue$/,
              loader: 'vue-loader',
            }
          ```
        </section>
        <section data-markdown>
          <p>
            JQuery以及其扩展库，如bootstrap.modal.js, jquery.datatable.js
          </p>
          <p>使用*expose-loader*暴露*$*和*JQuery*</p>
        </section>

        <section data-markdown>
          webpack的主要组成部分：
          entry：一个可执行模块的入口文件
          output：模块的出口目录
          chunk：多个文件组成的一个代码块
          loader：模块转换器，确定处理方式
          plugin：插件，拓展webpack功能，与loader一同定义webpack的处理方式
        </section>
        <section data-markdown>
          webpack构建过程：
          读取并初始化option
          编译
          递归分析依赖，按照依赖build
          构建，构建过程中会用相应的loader
          构建完毕后编译，生成AST抽象语法树
          遍历AST，在有依赖时，收集依赖
          打包前合并、压缩等
          输出文件
        </section>
        <section data-markdown>
          
        </section>
        <section data-markdown>
          
        </section>
        <section data-markdown>
          ### Webpack
          * file-loader
          * url-loader
          * html-loader
          * css-loader
          * style-loader
          * expose-loader
          * babel-loader
        </section>
        <section>
        <section>Slide 2</section>
      <section>Slide 3</section>
    </section>
    <section data-markdown>
      ## Page title
      A paragraph with some text and a [link](http://hakim.se).
    </section>
    <section data-markdown>
      <script type="text/template">
      - Item 1 <!-- .element: class="fragment" data-fragment-index="2" -->
      - Item 2 <!-- .element: class="fragment" data-fragment-index="1" -->
      </script>
    </section>
  </div>
</div>
</body>
</html>